# China VPN Server Configuration
# OpenVPN server configuration optimized for China access

# Network settings
port 1194
proto udp
dev tun

# SSL/TLS root certificate (ca), certificate (cert), and private key (key)
ca /etc/openvpn/server/ca.crt
cert /etc/openvpn/server/server.crt
key /etc/openvpn/server/server.key

# Diffie hellman parameters
dh /etc/openvpn/server/dh4096.pem

# Network topology
topology subnet

# Configure server mode and supply a VPN subnet
server 10.8.0.0 255.255.255.0

# Maintain a record of client <-> virtual IP address associations
ifconfig-pool-persist /var/log/openvpn/ipp.txt

# Configure server mode for ethernet bridging
;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100

# Push routes to the client to allow it to reach other private subnets
;push "route 192.168.10.0 255.255.255.0"
;push "route 192.168.20.0 255.255.255.0"

# Push DNS servers to clients
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"
push "dhcp-option DNS 114.114.114.114"
push "dhcp-option DNS 223.5.5.5"

# Push all traffic through VPN (comment out if you don't want this)
push "redirect-gateway def1 bypass-dhcp"

# Allow clients to communicate with each other
client-to-client

# Keep clients connected through network interruptions
keepalive 10 120

# TLS authentication key
tls-auth /etc/openvpn/server/ta.key 0

# Cryptographic cipher
cipher AES-256-CBC

# Message authentication
auth SHA256

# Enable compression on the VPN link
comp-lzo

# Maximum number of concurrently connected clients
max-clients 100

# Run OpenVPN with reduced privileges
user nobody
group nogroup

# Persist certain options across restarts
persist-key
persist-tun

# Output a short status file showing current connections
status /var/log/openvpn/openvpn-status.log

# Log verbosity level
verb 3

# Silence repeating messages
mute 20

# Notify the client when the server restarts
explicit-exit-notify 1

# Security enhancements
remote-cert-tls client
tls-version-min 1.2

# Performance optimizations for China connections
sndbuf 0
rcvbuf 0
push "sndbuf 393216"
push "rcvbuf 393216"

# Fast I/O
fast-io

# TCP MSS fix for better performance
mssfix 1450

# Client configuration directory (for individual client configs)
client-config-dir /etc/openvpn/server/ccd

# Log file
log-append /var/log/openvpn/openvpn.log
